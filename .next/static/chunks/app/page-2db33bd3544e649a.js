(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1057:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var a=t(5155),r=t(2115);function l(){let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(!0),[d,i]=(0,r.useState)(null),[n,c]=(0,r.useState)(!1),[o,m]=(0,r.useState)(!1),[h,x]=(0,r.useState)(!1),[u]=(0,r.useState)(new Date().toISOString().split("T")[0]),[b,p]=(0,r.useState)(!1),[f,g]=(0,r.useState)({userId:"",password:""}),[y,w]=(0,r.useState)(null),j=e=>{let{name:s,value:t}=e.target;g(e=>({...e,[s]:t}))},v=async e=>{if(e.preventDefault(),w(null),!f.userId||!f.password)return void w("Both user ID and password are required");try{if(!(await fetch("/api/verify-creds",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).ok)throw Error("Invalid credentials");p(!1),await S()}catch(e){console.error("Authentication error:",e),w("Invalid credentials. Please try again.")}};(0,r.useEffect)(()=>{(async()=>{try{l(!0),i(null);let e=await fetch("/api/skus");if(!e.ok)throw Error("Failed to fetch SKUs: ".concat(e.status));let t=await e.json();s(t.map(e=>{var s;return{...e,batches:(null==(s=e.dailyBatches[0])?void 0:s.batches)||0}}))}catch(e){console.error("Failed to fetch SKUs:",e),i("Failed to load SKUs. Please try again.")}finally{l(!1)}})()},[u]);let N=(e,t)=>{let a=parseInt(t)||0;s(s=>s.map(s=>s.id===e?{...s,batches:a}:s))},k=async()=>{m(!0),x(!1);try{if(!(await fetch("/api/batches",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batchData:e.filter(e=>e.batches>0).map(e=>({skuId:e.id,batches:e.batches,date:u}))})})).ok)throw Error("Failed to save batches");x(!0),setTimeout(()=>{x(!1)},3e3)}catch(e){console.error("Error saving batches:",e),i("Failed to save batches. Please try again.")}finally{m(!1)}},S=async()=>{c(!0);try{let s=await fetch("/api/generate-excel",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic ".concat(btoa("".concat(f.userId,":").concat(f.password)))},body:JSON.stringify({batchData:e.map(e=>({skuId:e.id,batches:e.batches}))})});if(!s.ok)throw Error("Failed to generate Excel");let t=await s.blob(),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="material_requirements.xlsx",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),r.remove()}catch(e){console.error("Error generating Excel:",e),alert("Failed to generate Excel file. Please try again.")}finally{c(!1)}};return t?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-20",children:[(0,a.jsx)("header",{className:"fixed top-0 left-0 right-0 bg-white shadow-sm z-10",children:(0,a.jsx)("div",{className:"px-4 py-4",children:(0,a.jsx)("h1",{className:"text-xl font-bold text-blue-700",children:"Batch Entry"})})}),(0,a.jsx)("main",{className:"pt-16 px-4 pb-24",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"})})})]}):d?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-20",children:[(0,a.jsx)("header",{className:"fixed top-0 left-0 right-0 bg-white shadow-sm z-10",children:(0,a.jsx)("div",{className:"px-4 py-4",children:(0,a.jsx)("h1",{className:"text-xl font-bold text-blue-700",children:"Batch Entry"})})}),(0,a.jsxs)("main",{className:"pt-20 px-4 pb-24",children:[(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4",children:d}),(0,a.jsx)("button",{onClick:()=>{i(null),window.location.reload()},className:"w-full bg-blue-500 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg shadow-sm",children:"Retry"})]})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"fixed top-0 left-0 right-0 bg-white shadow-sm z-10",children:(0,a.jsx)("div",{className:"px-4 py-4",children:(0,a.jsx)("h1",{className:"text-xl font-bold text-blue-700",children:"Batch Entry"})})}),(0,a.jsxs)("main",{className:"pt-16 px-4 pb-24 max-w-lg mx-auto",children:[h&&(0,a.jsxs)("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg mb-4 mt-2 flex items-center",children:[(0,a.jsx)("svg",{className:"h-5 w-5 text-green-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,a.jsx)("span",{children:"Batches saved successfully!"})]}),0===e.length?(0,a.jsx)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg mt-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{className:"h-5 w-5 text-yellow-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,a.jsx)("span",{children:"No SKUs found. Please add SKUs in the admin section first."})]})}):(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg overflow-hidden mt-4",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsx)("h2",{className:"font-medium text-gray-700",children:"Enter Batch Quantities"})}),(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,a.jsx)("li",{className:"p-4 hover:bg-gray-50",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{className:"mb-2 sm:mb-0",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.code}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("label",{className:"mr-2 text-sm text-gray-600",children:"Batches:"}),(0,a.jsx)("input",{type:"number",min:"0",className:"border rounded-lg py-2 px-3 w-20 focus:ring-blue-500 text-black focus:border-blue-500 text-center",value:e.batches||"",onChange:s=>N(e.id,s.target.value)})]})]})},e.id))})]})]}),(0,a.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 max-w-lg mx-auto",children:[(0,a.jsx)("button",{onClick:k,disabled:o||e.every(e=>0===e.batches),className:"flex-1 flex justify-center items-center px-4 py-3 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Batches"}),(0,a.jsx)("button",{onClick:()=>{p(!0)},disabled:n||0===e.length,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(n||0===e.length?"opacity-50 cursor-not-allowed":""),children:"Generate Excel Report"})]})}),b&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-black mb-4",children:"Authentication Required"}),(0,a.jsxs)("form",{onSubmit:v,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm text-black font-medium mb-1",children:"User ID"}),(0,a.jsx)("input",{type:"text",name:"userId",value:f.userId,onChange:j,className:"border rounded py-2 px-3 w-full text-black",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm text-black font-medium mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",name:"password",value:f.password,onChange:j,className:"border rounded py-2 px-3 w-full text-black",required:!0})]}),y&&(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:y}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:n,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 ".concat(n?"opacity-50 cursor-not-allowed":""),children:n?"Verifying...":"Generate Excel"})]})]})]})})]})}},7065:(e,s,t)=>{Promise.resolve().then(t.bind(t,1057))}},e=>{var s=s=>e(e.s=s);e.O(0,[441,684,358],()=>s(7065)),_N_E=e.O()}]);