(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[833],{4832:(e,t,a)=>{Promise.resolve().then(a.bind(a,5180))},5180:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var s=a(5155),i=a(2115);function r(){var e;let[t,a]=(0,i.useState)([]),[r,l]=(0,i.useState)([]),[d,c]=(0,i.useState)(""),[n,o]=(0,i.useState)([]),[m,u]=(0,i.useState)(!0),[h,x]=(0,i.useState)(null),[p,f]=(0,i.useState)(!1),[b,y]=(0,i.useState)(null),[w,g]=(0,i.useState)(""),[j,N]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{try{u(!0),x(null);let e=await fetch("/api/skus");if(!e.ok)throw Error("Failed to fetch SKUs: ".concat(e.status));let t=await e.json();a(t);let s=await fetch("/api/raw-materials");if(!s.ok)throw Error("Failed to fetch raw materials: ".concat(s.status));let i=await s.json();l(i),t.length>0&&c(t[0].id)}catch(e){console.error("Failed to fetch initial data:",e),x("Failed to load data. Please try again.")}finally{u(!1)}})()},[]),(0,i.useEffect)(()=>{(async()=>{if(d)try{u(!0);let e=await fetch("/api/recipes?skuId=".concat(d));if(!e.ok)throw Error("Failed to fetch recipe items: ".concat(e.status));let t=await e.json();o(t)}catch(e){console.error("Failed to fetch recipe items:",e),x("Failed to load recipe items. Please try again.")}finally{u(!1)}})()},[d]);let v=async e=>{if(e.preventDefault(),!d||!w||!j)return void x("All fields are required");try{f(!0),x(null);let e=await fetch("/api/recipes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({skuId:d,rawMaterialId:w,quantity:parseFloat(j)})});if(!e.ok)throw Error("Failed to add recipe item: ".concat(e.status));let t=await fetch("/api/recipes?skuId=".concat(d)),a=await t.json();o(a),g(""),N(""),y("Recipe item added successfully"),setTimeout(()=>y(null),3e3)}catch(e){console.error("Failed to add recipe item:",e),x("Failed to add recipe item. Please try again.")}finally{f(!1)}},k=async e=>{if(confirm("Are you sure you want to delete this ingredient from the recipe?"))try{u(!0);let t=await fetch("/api/recipes?skuId=".concat(d,"&rawMaterialId=").concat(e),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete recipe item: ".concat(t.status));o(n.filter(t=>t.rawMaterialId!==e)),y("Recipe item deleted successfully"),setTimeout(()=>y(null),3e3)}catch(e){console.error("Failed to delete recipe item:",e),x("Failed to delete recipe item. Please try again.")}finally{u(!1)}};return m&&0===t.length?(0,s.jsxs)("div",{className:"container mx-auto p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Recipe Management"}),(0,s.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})})]}):(0,s.jsxs)("div",{className:"container mx-auto p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Recipe Management"}),h&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:h}),b&&(0,s.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:b}),0===t.length?(0,s.jsx)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:"No SKUs found. Please add SKUs in the admin section first."}):(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-gray-700 font-semibold mb-2",children:"Select SKU:"}),(0,s.jsx)("select",{className:"w-full p-2 border bg-white text-gray-900 rounded-md focus:border-blue-500 focus:outline-none",value:d,onChange:e=>{c(e.target.value),g(""),N("")},children:t.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))})]}),(0,s.jsxs)("div",{className:" shadow-md rounded-lg overflow-hidden",children:[(0,s.jsxs)("h2",{className:" px-6 py-3 text-lg font-semibold border-b",children:["Recipe for ",(null==(e=t.find(e=>e.id===d))?void 0:e.name)||""]}),m?(0,s.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})}):0===n.length?(0,s.jsx)("div",{className:"p-6 text-gray-500 italic",children:"No ingredients added to this recipe yet."}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:" divide-y divide-gray-200",children:n.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"font-medium",children:e.rawMaterial.name})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.quantity}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.rawMaterial.unit}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("button",{onClick:()=>k(e.rawMaterialId),className:"text-red-600 hover:text-red-900",children:"Delete"})})]},e.id))})]})})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4 text-black",children:"Add Ingredient"}),(0,s.jsxs)("form",{onSubmit:v,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Raw Material:"}),(0,s.jsxs)("select",{className:"w-full p-2 border rounded-md focus:border-blue-500 text-black focus:outline-none",value:w,onChange:e=>g(e.target.value),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select a raw material"}),r.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.unit,")"]},e.id))]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Quantity:"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.0001",className:"w-full p-2 border rounded-md text-black focus:border-blue-500 focus:outline-none",value:j,onChange:e=>N(e.target.value),required:!0,placeholder:"Enter quantity"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:p,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ".concat(p?"opacity-50 cursor-not-allowed":""),children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Adding..."]}):"Add to Recipe"})})]})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(4832)),_N_E=e.O()}]);